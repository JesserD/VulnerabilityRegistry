using System.Text.Json.Serialization;

namespace Domain;

public class Vulnerability
{
    public required string Type { get; set; }

    [JsonPropertyName("spec_version")]
    public required string SpecVersion { get; set; }

    public required string Id { get; set; }

    public required DateTime Created { get; set; }

    public required DateTime Modified { get; set; }

    public required string Name { get; set; }

    public string? Description { get; set; }

    public static bool IsValidSpecVersion(string specVersion) =>
        specVersion.Equals("2.0") || specVersion.Equals("2.1");

    public static bool IsValidStixVulnerabilityId(string id)
    {
        if (string.IsNullOrEmpty(id))
            return false;

        var expectedIdPrefix = "vulnerability--";
        if (!id.StartsWith(expectedIdPrefix))
            return false;

        var guidPart = id.Substring(expectedIdPrefix.Length);
        return Guid.TryParse(guidPart, out _);
    }
}

